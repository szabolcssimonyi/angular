<form [formGroup]="form" (ngSubmit)="onSave()" novalidate>
    <div class="ui-g ui-fluid form-group">
        <div class="ui-g-12 main-content">
            <div class="ui-g-12 ui-md-2">
                <div class="ui-g-12 ui-md-12">
                    <image-cropper [imageChangedEvent]="imageChangedEvent" [maintainAspectRatio]="true"
                        *ngIf="imageChangedEvent" [aspectRatio]="4 / 3" [resizeToWidth]="128" format="png"
                        (imageCropped)="imageCropped($event)" outputType='both'>
                    </image-cropper>
                </div>
                <div class="ui-g-12" class="avatar-container" *ngIf="!imageChangedEvent">
                    <img class="profile-image" src="{{ avatarObject }}" />
                </div>
                <div class="ui-g-12">
                    <p-fileUpload accept="image/*" (onSelect)="addAvatar($event)" mode='basic' #avatarUploader
                        chooseLabel="{{ 'USER.AVATAR_ADD' | translate }}"></p-fileUpload>
                </div>
            </div>
            <div class="ui-g-12 ui-md-5">
                <span class="md-inputfield">
                    <input type="text" pInputText formControlName="username">
                    <label>{{ 'USER.USER_NAME' | translate }}</label>
                    <div *ngIf="form.get('username').invalid && (form.get('username').dirty || form.get('username').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('username').errors.required">
                            {{ 'USER.ERRORS.USERNAME_REQUIRED' | translate }}
                        </div>
                        <div *ngIf="form.get('username').errors.minlength || form.get('username').errors.maxlength">
                            {{ 'USER.ERRORS.USERNAME_LENGTH' | translate }}
                        </div>
                    </div>
                </span>
            </div>
            <div class="ui-g-12 ui-md-5">
                <span class="md-inputfield">
                    <p-dropdown [options]="genders" formControlName="gender_id" appendTo="body">
                    </p-dropdown>
                    <div *ngIf="form.get('gender_id').invalid && (form.get('gender_id').dirty || form.get('gender_id').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('gender_id').errors.notselected">
                            {{ 'USER.ERRORS.GENDER_REQUIRED' | translate }}
                        </div>
                    </div>
                </span>
            </div>
            <div class="ui-g-12 ui-md-5">
                <span class="md-inputfield">
                    <input type="text" pInputText formControlName="firstname">
                    <label>{{ 'USER.FIRST_NAME' | translate }}</label>
                    <div *ngIf="form.get('firstname').invalid && (form.get('firstname').dirty || form.get('firstname').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('firstname').errors.required">
                            {{ 'USER.ERRORS.USERNAME_REQUIRED' | translate }}
                        </div>
                        <div *ngIf="form.get('firstname').errors.minlength || form.get('firstname').errors.maxlength">
                            {{ 'USER.ERRORS.USERNAME_LENGTH' | translate }}
                        </div>
                    </div>
                </span>
            </div>
            <div class="ui-g-12 ui-md-5">
                <span class="md-inputfield">
                    <input type="text" pInputText formControlName="lastname">
                    <label>{{ 'USER.LAST_NAME' | translate }}</label>
                    <div *ngIf="form.get('lastname').invalid && (form.get('lastname').dirty || form.get('lastname').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('lastname').errors.required">
                            {{ 'USER.ERRORS.USERNAME_REQUIRED' | translate }}
                        </div>
                        <div *ngIf="form.get('lastname').errors.minlength || form.get('lastname').errors.maxlength">
                            {{ 'USER.ERRORS.USERNAME_LENGTH' | translate }}
                        </div>
                    </div>
                </span>
            </div>
            <div class="ui-g-12 ui-md-5">
                <span class="md-inputfield">
                    <input type="text" pInputText formControlName="email">
                    <label>{{ 'USER.EMAIL' | translate }}</label>
                    <div *ngIf="form.get('email').invalid && (form.get('email').dirty || form.get('email').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('email').errors.required">
                            {{ 'USER.ERRORS.EMAIL_REQUIRED' | translate }}
                        </div>
                        <div *ngIf="!form.get('email').errors.required && form.get('email').errors.email">
                            {{ 'USER.ERRORS.EMAIL_FORMAT' | translate }}
                        </div>
                    </div>
                </span>
            </div>
            <div class="ui-g-12 ui-md-5">
                <span class="md-inputfield">
                    <input type="text" pInputText formControlName="tel">
                    <label>{{ 'USER.PHONE' | translate }}</label>
                    <div *ngIf="form.get('tel').invalid && (form.get('tel').dirty || form.get('tel').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('tel').errors.minlength || form.get('tel').errors.maxlength">
                            {{ 'USER.ERRORS.PHONE_LENGTH' | translate }}
                        </div>
                    </div>
                </span>
            </div>
        </div>
        <div class="ui-g-12 secondary-content">
            <div class="ui-g-12  ui-md-5 ui-md-offset-2 ui-sm-12">
                <span class="md-inputfield">
                    <p-dropdown [options]="groups" formControlName="group" appendTo="body">
                    </p-dropdown>
                    <div *ngIf="form.get('group').invalid && (form.get('group').dirty || form.get('group').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('group').errors.notselected">
                            {{ 'USER.ERRORS.GROUP_REQUIRED' | translate }}
                        </div>
                    </div>
                </span>
            </div>
            <div class="ui-g-12  ui-md-5 ui-sm-12">
                <span class="md-inputfield">
                    <input type="text" pInputText formControlName="external_id">
                    <label>{{ 'USER.GROUPS_NUMBER' | translate }}</label>
                </span>
            </div>
            <div class="ui-g-12  ui-md-5 ui-md-offset-2 ui-sm-12">
                <span class="md-inputfield">
                    <p-dropdown [options]="jobs" formControlName="job" appendTo="body">
                    </p-dropdown>
                    <div *ngIf="form.get('job').invalid && (form.get('job').dirty || form.get('job').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('job').errors.notselected">
                            {{ 'USER.ERRORS.JOB_REQUIRED' | translate }}
                        </div>
                    </div>
                </span>
            </div>
            <div class="ui-g-12  ui-md-5 ui-sm-12">
                <span class="md-inputfield">
                    <p-calendar formControlName="work_started_date" dateFormat="yy-mm-dd" appendTo="body"
                        [yearNavigator]="true" yearRange="2000:2030">
                    </p-calendar>
                    <label>{{ 'USER.FIRSTWORK_DATE' | translate }}</label>
                </span>
            </div>
            <div class="ui-g-12 ui-md-5 ui-md-offset-2 ui-sm-12">
                <span class="md-inputfield">
                    <p-dropdown [options]="roles" formControlName="role" appendTo="body">
                    </p-dropdown>
                    <div *ngIf="form.get('role').invalid && (form.get('role').dirty || form.get('role').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('role').errors.notselected">
                            {{ 'USER.ERRORS.ROLE_REQUIRED' | translate }}
                        </div>
                    </div>
                </span>
            </div>
            <div class="ui-g-12 ui-md-5">
                <span class="md-inputfield">
                    <p-dropdown [options]="states" formControlName="active" appendTo="body"></p-dropdown>
                    <div *ngIf="form.get('active').invalid && (form.get('active').dirty || form.get('active').touched)"
                        class="ui-message ui-messages-error ui-corner-all">
                        <div *ngIf="form.get('active').errors.notselected">
                            {{ 'USER.ERRORS.STATE_REQUIRED' | translate }}
                        </div>
                    </div>
                </span>
            </div>
        </div>
        <div class="ui-g-12 secondary-content">
            <div class="ui-g-12 ui-md-3" *ngIf="isEdit">
                <button pButton type="button" label="{{ 'USER.RESET_PASSWORD' | translate }}"
                    class="ui-button-secondary flat" (click)="onResetPassword()"
                    [disabled]="form.get('email').invalid && (form.get('email').dirty || form.get('email').touched)"></button>
            </div>
            <div [class.ui-md-offset-10]="!isEdit" [class.ui-md-offset-7]="isEdit" class="ui-g-12 ui-md-2">
                <button pButton type="submit" label="{{ 'GLOBAL.SAVE' | translate }}" class="purple-btn"
                    [disabled]="!isUserFormValid"></button>
            </div>
        </div>
    </div>
</form>